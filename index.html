<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>Macky Snake.io</title>
<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#000;
  color:white;
  text-align:center;
  overflow:hidden;
  touch-action:none;
}

canvas{
  background:#111;
  display:block;
  margin:auto;
  border:3px solid #00ff88;
  border-radius:10px;
}

button{
  font-size:20px;
  margin:10px 0 20px 0;
  padding:10px 25px;
  border:none;
  border-radius:8px;
  background:#00ff88;
  font-weight:bold;
}

.screen{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.95);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}

.hidden{ display:none; }

/* MOBILE CONTROLS */
#mobileControls{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  display:none; /* start hidden */
  gap:10px;
  z-index:999;
  grid-template-columns:repeat(3,80px);
  grid-template-rows:repeat(3,80px);
}

.ctrl{
  font-size:32px;
  border-radius:12px;
  background:rgba(0,255,136,0.9);
  display:flex;
  align-items:center;
  justify-content:center;
  user-select:none;
  width:80px;
  height:80px;
}
.ctrl:active{ background:#00cc66; }

select{ padding:8px; font-size:16px; margin:5px; }

#scoreDisplay{
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  font-size:24px;
  z-index:999;
}

@media (max-width:768px){
  .ctrl{
    width:80px;
    height:80px;
    font-size:36px;
  }
  #menuScreen h1,
  #skinsScreen h1,
  #instructionsScreen h1,
  #difficultyScreen h1{
    margin-top:50px;
    font-size:28px;
  }
  #menuScreen button,
  #skinsScreen button,
  #instructionsScreen button,
  #difficultyScreen button{
    margin:15px 0 20px 0;
    width:180px;
  }
}
</style>
</head>
<body>

<!-- MENU -->
<div id="menuScreen" class="screen">
  <h1>üêç Macky test Snake üêç</h1>
  <button onclick="startGame()">Play</button>
  <button onclick="showSkins()">Skins</button>
  <button onclick="showInstructions()">Instructions</button>
</div>

<!-- DIFFICULTY -->
<div id="difficultyScreen" class="screen hidden">
  <h1>Select Difficulty</h1>
  <button onclick="selectDifficulty('easy')">Easy üê¢</button>
  <button onclick="selectDifficulty('medium')">Medium üêá</button>
  <button onclick="selectDifficulty('hard')">Hard ‚ö°</button>
</div>

<!-- SKINS -->
<div id="skinsScreen" class="screen hidden">
  <h1>Snake Customization</h1>
  <p>Color:</p>
  <select id="skinSelector">
    <option value="#00ff88">Green</option>
    <option value="#ff0088">Pink</option>
    <option value="#00ccff">Blue</option>
    <option value="#ffaa00">Orange</option>
  </select>
  <p>Shape:</p>
  <select id="shapeSelector">
    <option value="circle">Circle ‚≠ï</option>
    <option value="square">Square ‚¨õ</option>
  </select>
  <br>
  <button onclick="backToMenu()">Back</button>
</div>

<!-- INSTRUCTIONS -->
<div id="instructionsScreen" class="screen hidden">
  <h1>How to Play</h1>
  <p>Use buttons or arrow keys to move.</p>
  <p>Eat food üçé, avoid walls & tail.</p>
  <button onclick="backToMenu()">Back</button>
</div>

<!-- GAME OVER -->
<div id="gameOverScreen" class="screen hidden">
  <h1>üíÄ Game Over</h1>
  <h2>Score: <span id="finalScore"></span></h2>
  <button onclick="retryGame()">Retry</button>
  <button onclick="backToMenu()">Menu</button>
</div>

<!-- SCORE -->
<div id="scoreDisplay">Score: <span id="score">0</span></div>
<canvas id="game"></canvas>

<!-- MOBILE CONTROLS -->
<div id="mobileControls">
  <div></div> <div class="ctrl" data-dir="UP">‚¨ÜÔ∏è</div> <div></div>
  <div class="ctrl" data-dir="LEFT">‚¨ÖÔ∏è</div> <div></div> <div class="ctrl" data-dir="RIGHT">‚û°Ô∏è</div>
  <div></div> <div class="ctrl" data-dir="DOWN">‚¨áÔ∏è</div> <div></div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const size = 30; 
let tile = 20;

// RESIZE
function resizeCanvas(){
  const maxWidth = window.innerWidth-20;
  const maxHeight = window.innerHeight-100;
  tile = Math.floor(Math.min(maxWidth,maxHeight)/size);
  canvas.width = tile*size;
  canvas.height = tile*size;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

// GAME VARS
let snake, food, score;
let dir, nextDir;
let interval;
let speed = 200;
let skin = "#00ff88";
let shape = "circle";

const speeds = { easy: 300, medium: 200, hard: 100 };

// TOUCH CONTROLS
document.querySelectorAll(".ctrl").forEach(btn=>{
  btn.addEventListener("pointerdown", e=>{
    e.preventDefault();
    setDir(btn.dataset.dir);
  });
});

function setDir(newDir){
  if(newDir==='UP' && dir!=='DOWN') nextDir='UP';
  if(newDir==='DOWN' && dir!=='UP') nextDir='DOWN';
  if(newDir==='LEFT' && dir!=='RIGHT') nextDir='LEFT';
  if(newDir==='RIGHT' && dir!=='LEFT') nextDir='RIGHT';
}

// MENU NAV
function hideAll(){ document.querySelectorAll(".screen").forEach(s=>s.classList.add("hidden")); }
function hideControls(){ document.getElementById("mobileControls").style.display="none"; }
function showSkins(){ hideAll(); skinsScreen.classList.remove("hidden"); hideControls(); }
function showInstructions(){ hideAll(); instructionsScreen.classList.remove("hidden"); hideControls(); }
function backToMenu(){ hideAll(); menuScreen.classList.remove("hidden"); hideControls(); }

// START GAME ‚Üí SHOW DIFFICULTY FIRST
function startGame(){
  hideAll();
  difficultyScreen.classList.remove("hidden");
  hideControls();
}

// SELECT DIFFICULTY ‚Üí START GAME
function selectDifficulty(level){
  speed = speeds[level];
  hideAll();

  // Init game vars
  skin = document.getElementById("skinSelector").value;
  shape = document.getElementById("shapeSelector").value;
  snake = [{x:Math.floor(size/2)*tile, y:Math.floor(size/2)*tile}];
  dir = 'RIGHT';
  nextDir = 'RIGHT';
  score = 0;
  food = randomFood();
  document.getElementById("score").textContent = score;

  clearInterval(interval);
  interval = setInterval(loop, speed);

  // Show mobile controls only if on mobile
  if(window.innerWidth <= 768){
    document.getElementById("mobileControls").style.display = "grid";
  }
}

// RETRY
function retryGame(){ startGame(); }

// FOOD SPAWN
function randomFood(){
  let x, y;
  do{
    x = Math.floor(Math.random()*size)*tile;
    y = Math.floor(Math.random()*size)*tile;
  } while(snake.some(p=>p.x===x && p.y===y));
  return {x,y};
}

// GAME LOOP
function loop(){
  dir = nextDir;
  let head = {...snake[0]};

  if(dir==='UP') head.y -= tile;
  if(dir==='DOWN') head.y += tile;
  if(dir==='LEFT') head.x -= tile;
  if(dir==='RIGHT') head.x += tile;

  if(head.x<0||head.y<0||head.x>=canvas.width||head.y>=canvas.height||snake.some(p=>p.x===head.x&&p.y===head.y)){
    gameOver(); return;
  }

  snake.unshift(head);

  if(head.x===food.x && head.y===food.y){
    score++;
    document.getElementById("score").textContent = score;
    food=randomFood();
  } else snake.pop();

  draw();
}

// DRAW
function draw(){
  ctx.fillStyle="#111";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.strokeStyle="#222";
  for(let x=0;x<=canvas.width;x+=tile){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke(); }
  for(let y=0;y<=canvas.height;y+=tile){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke(); }

  ctx.font=tile+"px Arial";
  ctx.textAlign="left";
  ctx.textBaseline="top";
  ctx.fillText("üçé", food.x, food.y);

  ctx.fillStyle = skin;
  snake.forEach(p=>{
    if(shape==="circle"){ ctx.beginPath(); ctx.arc(p.x+tile/2,p.y+tile/2,tile/2,0,Math.PI*2); ctx.fill(); }
    else{ ctx.fillRect(p.x,p.y,tile,tile); }
  });
}

// GAME OVER
function gameOver(){
  clearInterval(interval);
  document.getElementById("finalScore").textContent = score;
  gameOverScreen.classList.remove("hidden");
  hideControls();
}
</script>
</body>
</html>